# Symfony REST-приложение для расчета цены продукта и проведения оплаты
## Требования

- Docker
- Docker Compose

## Начало работы

Чтобы развернуть проект, выполните следующие шаги:

1. Клонируйте репозиторий:

   ```bash
   git clone <repository_url>
   cd <repository_name>
   ```

2. Для запуска проекта выполните команду:

   ```bash
   make init
   ```

Эта команда настроит Symfony-приложение, смонтирует текущую директорию в контейнер и запустит приложение на порту `8337`.

3. Применим миграции:
    ```bash
    make migrate
    ```

4. Далее запустим фикстуры:

     ```bash
     make fixtures
      ```

## Эндпоинты

### Расчет цены

- **URL**: `http://127.0.0.1:8337/calculate-price`
- **Метод**: `POST`
- **Тело запроса**:

  ```json
  {
      "product": 1,
      "taxNumber": "DE123456789",
      "couponCode": "P20"
  }
  ```

- **Ответ**:
    - **200 OK**: Успешный расчет цены.
    - **400 Bad Request**: Неверные входные данные или ошибка при расчете.

### Покупка

- **URL**: `http://127.0.0.1:8337/purchase`
- **Метод**: `POST`
- **Тело запроса**:

  ```json
  {
      "product": 1,
      "taxNumber": "IT12345678900",
      "couponCode": "D15",
      "paymentProcessor": "paypal"
  }
  ```

- **Ответ**:
    - **200 OK**: Успешная покупка.
    - **400 Bad Request**: Неверные входные данные или ошибка оплаты.

## Продукты

Продукты хранятся в базе данных:

- **IPhone 15 Pro Max, 256**: 1280 евро
- **MacBook Pro 16-inch M3 MAX (2023) 14CPU/30GPU, 36GB RAM, 1TB**: 3600 евро
- **iPad Pro 13" (2024)**: 10 евро
- **AirPods Max**: 10 евро
- **Watch Ultra 2 Titanium Case with Ocean Band" (2024)**: 10 евро

## Купоны

Купоны хранятся в системе и могут быть двух типов:

- Фиксированная сумма скидки
- Процент от суммы покупки

Примеры:

- `P10`: скидка 10%
- `P15`: скидка 15%
- `F100`: фиксированная скидка 100 евро
- `F200`: фиксированная скидка 200 евро

## Расчет налога

Налог рассчитывается исходя из кода страны в налоговом номере:

- **Германия**: 19%
- **Италия**: 22%
- **Франция**: 20%
- **Греция**: 24%

## Валидация

Приложение использует Symfony Validator для валидации входных данных, включая форматы налоговых номеров:

- **Германия**: `DEXXXXXXXXX`
- **Италия**: `ITXXXXXXXXXXX`
- **Греция**: `GRXXXXXXXXX`
- **Франция**: `FRYYXXXXXXXXX`

## Обработка платежей

Приложение поддерживает обработку платежей через PayPal и Stripe с использованием предоставленных классов:

- `PaypalPaymentProcessor::pay()`
- `StripePaymentProcessor::processPayment()`

## Тестирование

Для тестов используйте следующую команду:
   ```bash
   make test
   ```